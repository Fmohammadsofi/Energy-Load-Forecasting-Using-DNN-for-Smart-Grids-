function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 07-Oct-2015 15:11:04.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [0;1;2007;1;0;8;-9;3891.5;3891.5];
x1_step1_gain = [0.0869565217391304;0.181818181818182;0.4;0.333333333333333;2;0.0210526315789474;0.0235294117647059;0.000264690312334569;0.000264690312334569];
x1_step1_ymin = -1;

% Layer 1
b1 = [-18.010473504312117;17.360473309847261;1.6670550352441846;2.3275171602539877;-1.4011718030824758;0.60386114082161069;-0.49286493714825347;-3.7965687247652178;-0.60047418822304077;0.39474188087736956;-0.15527896664044297;-0.038317901230067168;-0.17533222541001706;-3.6585402857500933;-0.20865994359031703;-0.33424357458689441;0.59516360732817353;1.8501515634107304;-0.74974901739026956;-0.64843732557162248];
IW1_1 = [4.6492083162501494 -0.046706860912166547 -0.13637735985270905 -20.636698528259608 -6.6231247085569898 0.14953992678750466 0.0033515775883616004 -0.32190900124740701 0.86342663382795437;-9.7925304191019489 1.9109871896750188 7.6496557043329929 -2.2523402028797652 0.38427379337114004 -18.764481318031542 11.255942845627111 16.567865915725182 10.257480808611732;0.0981773537403276 0.13857919664665211 -0.0080304717608760505 -0.00090675411333245417 0.063386342419249134 -1.5218412798471017 -1.0865641728811997 -0.2483677318818962 -0.024641800395251871;-1.5881631655064852 3.253405290613447 1.5541359352453814 -3.4640342577508045 2.8751313461500447 1.9064170196260226 -0.13336299443836516 0.046512479281250713 5.1524220873270625;-7.7934261175853043 8.0707509108230848 -0.39386438774429572 -2.8416899596735967 5.364956360876123 -5.9966341967643064 2.7481414733796985 1.1714412728186696 -0.24080638556871925;-0.14698191435920735 -1.2516140614084579 -0.079469441843309147 0.10766095016133113 0.039068745619777898 0.24383221346303835 0.93000415344041076 -0.56056402440330011 -0.94402842546130139;-0.071716690384371617 3.0930909899767314 -0.013628669375246275 0.053654755538872653 -0.12115884877782006 0.53525837517787522 -0.27410297320646626 -0.0073974532966666834 -0.057989558606804568;2.838806980388469 1.4169594339799823 6.372009935673832 0.056849884001378713 0.12609896609379934 0.48524279320004859 -3.3146534576543543 -5.6540402676889796 -3.3154673167068669;0.041154658985253556 -0.197178706955601 -0.054463743592665238 0.0057927241632528079 0.017255015573675449 -1.3065342454687552 0.46546380673529769 -0.17272818193434811 0.12267041947783899;0.072332848777996298 -3.1485122685739824 0.035684553310546735 -0.066110106818041511 0.11747491086075183 -0.33502101497541237 0.28320323559094568 -0.06597264848559295 0.020271968124471577;-1.0574573007314909 -0.06924558939776071 0.020091609496611634 0.14631864175494377 0.11535773958778588 0.42157256137130339 -0.39263436079252523 0.07594214402473351 -0.11422131194620963;0.64196692271792644 0.029911577991486565 -0.011866340205517533 -0.069426806047624551 -0.061201893737766508 -0.22027671770350779 0.15200083155787286 -0.076874411369617257 0.060956296879615443;4.7889675773922642 0.011825562399430235 0.011952742927822254 -0.16121609549033372 -2.4233990970993462 0.2563637573461523 0.023327176029496084 0.4350731022593991 -0.26700123868913539;-0.57069461175493497 -0.60944756030660396 -17.317513393081413 -0.20771294970617987 0.26570213124541198 -0.48765786848945897 -0.59096250050033272 -2.9578258510715862 4.0832614167205312;0.16850416904758875 -0.0064977805191086804 -0.0086137891128125338 -0.021204527185776412 -0.039254601212862172 -0.13536020235000726 0.059070974547398708 -0.071684901998612757 0.021690950168273004;-0.62116195790802353 0.065395530351620046 0.004607879425318367 -0.02961242576036411 -0.83982382405752776 -0.33323577205997174 -0.12394690116923858 0.045304085779599358 0.061171305622535845;1.2960963170341155 -0.10475973110014694 -0.020103877653080474 0.0075743583651244574 -1.4496877940790365 0.61972385701038024 0.13368811233267619 -0.057010124053664506 -0.10596318905460532;6.9315801476396004 0.076126642511135975 0.0095146358561709471 -0.075464400750330132 -0.73592450552985766 -0.54412644500023644 0.10874237651613586 -0.070131398751151167 -0.052381970753078939;-0.19241417245189454 0.95596924110351322 2.6268048218589497 0.15127727025005372 -0.10310830760152441 1.7938066434408964 -0.14459780323396784 -0.27025067662368912 0.88885703436672103;-0.19194869014289923 -1.5326723388209951 -0.14157104631955167 0.16803217301505249 -0.00012862346535908245 2.3923502922713737 0.33198056742964765 -0.83141998130135641 0.22051677739388847];

% Layer 2
b2 = -1.3087967659039732;
LW2_1 = [0.035337557710719919 -0.0011502893304334775 -0.4821152632493601 0.0091719738449461061 -0.0045987307655782203 0.13317512980210744 1.5760553032493219 0.0053549871665418631 0.67242400462333118 1.5484660988250256 1.1022463320140208 5.7895397372094282 0.10961384358992829 0.015893557596464249 -11.774874309139379 1.1943979878628566 -0.66718128130416687 0.10480144484737537 -0.026149558336629616 0.096938540481200403];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = 0.000264690312334569;
y1_step1_xoffset = 3891.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
